{% load static %}
<form id="reservation-form" class="mt-3"
      data-cottage-id="{{ cottage.id }}" 
      data-base-price="{{ cottage.base_price }}" 
      data-user-authenticated="{{ user.is_authenticated|yesno:'True,False' }}"
      data-login-url="{% url 'account_login' %}">
    {% csrf_token %}
    <div class="row g-2 mb-3">
        <div class="col-6">
            <label for="check-in" class="form-label">Check In</label>
            <input type="date" class="form-control" id="check-in" required>
        </div>
        <div class="col-6">
            <label for="check-out" class="form-label">Check Out</label>
            <input type="date" class="form-control" id="check-out" required>
        </div>
    </div>
    
    <div class="mb-3">
        <label for="guests" class="form-label">Guests</label>
        <select class="form-select" id="guests" required>
            {% for i in "12345"|make_list %}
                {% if forloop.counter <= cottage.beds %}
                <option value="{{ forloop.counter }}">{{ forloop.counter }} guest{{ forloop.counter|pluralize }}</option>
                {% endif %}
            {% endfor %}
        </select>
    </div>
    <!--CUSTOMER RELATED FIELDS-->
    <h6 class="mb-3 mt-4">Guest Information</h6>
    <div class="mb-3">
        <label for="full-name" class="form-label">Full Name</label>
        <input type="text" class="form-control" id="full-name" required 
               value="{{ user.get_full_name }}">
    </div>
    
    <div class="mb-3">
        <label for="email" class="form-label">Email</label>
        <input type="email" class="form-control" id="email" required
               value="{{ user.email }}">
    </div>
    
    <div class="mb-3">
        <label for="phone-number" class="form-label">Phone Number</label>
        <input type="tel" class="form-control" id="phone-number" required
               pattern="^\+?[0-9]{8,15}$" 
               title="Enter a valid phone number with 8-15 digits (may start with +)">
    </div>
    
    <div class="mb-3">
        <label for="address" class="form-label">Address</label>
        <input type="text" class="form-control" id="address" required>
    </div>

    <!--PRICE BREAKDOWN-->
    <div class="price-breakdown mb-3">
        <div class="d-flex justify-content-between py-2">
            <span id="price-label">Base price</span>
            <span id="price-display">€{{ cottage.base_price }}</span>
        </div>
        {% if cottage.cleaning_fee > 0 %}
        <div class="d-flex justify-content-between py-2">
            <span>Cleaning fee</span>
            <span id="cleaning-fee">€{{ cottage.cleaning_fee }}</span>
        </div>
        {% endif %}
        <div class="d-flex justify-content-between py-2 fw-bold border-top mt-2 pt-2">
            <span>Total</span>
            <span id="total-price">€{{ cottage.base_price|add:cottage.cleaning_fee }}</span>
        </div>
    </div>
    
    <button type="submit" id="reserve-button" class="btn btn-primary w-100">Reserve</button>
</form>


<script src="{% static 'js/reservations.js' %}"></script>
